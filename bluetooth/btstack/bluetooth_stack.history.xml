<?xml version="1.0" encoding="UTF-8"?>
<relnotes name="Bluetooth Stack PRT">
  <purpose>
    PRT plugin to ESock Sockets Server. Implements the Bluetooth protocol family and manages application level security (Bluetooth level 2).
  </purpose>

  <defect number="DEF141225" title="ou1cimx1#155408: Store SSP debug links in the registry during debug session " revision="217">
    Updated CPhysicalLink::StoreDeviceL() to allow SSP debug link keys to be stored in the registry.
    Also reverted fix for PDEF134727 (fix no longer required).
  </defect>

  <defect number="DEF140421" title="[upf33] Notification in wrong thread in AVCTPServices " revision="216">
    Fixed to allow notifications to be managed in the right thread. 
  </defect>

  <defect number="DEF140424" title="Coverity errors: DEADCODE, CHECKED_RETURN " revision="215">
    Fixed Coverity issues.
  </defect>

  <defect number="DEF140383" title="[upf33] Issues with AVDTP L2CAP configuration " revision="214">
    Passed the right populated configuration object to L2CAP channel.
  </defect>
  
  <defect number="PDEF139836" title=".esk and .cmi files do not have header" revision="213">
    Added copyright headers
  </defect>
  
  <defect number="DEF140084" title="Incorrect ASSERT in L2CAP" revision="212">
    Changed second assert in HL2CapPDU::SetPduOwner() to allow the case where the owner attempting to be set matches that already set.
  </defect>

 <defect number="DEF139363" title="Pending PDUs are not removed from the TDblQue before the queue is deleted" revision="211">
    Dequeued PDU's when they deregister from their owner and ensured that pdu's can not be assigned null owners or have ownership transferred
    by assigning a new owner when one already exists 
  </defect>

  <defect number="DEF135093" title="PREQ1760 Outstanding changes on L2CAP " revision="210">
    Some L2CAP work was outstanding post-PREQ1760 submission.
  </defect>

  <defect number="PDEF138340" title="Implement Errata 735 for AVDTP" revision="209">
    Implemented Errata 735 for new format of 'General Reject' response 
    Updated KAvdtpSignalIdentifierMask from 0x1F (5 bits) to 0x3F (6 bits). 
  </defect>

  <defect number="DEF138092" title="Move linkmgr/hci_v2 up a directory" revision="208">
    As hci_v2 is now the only version, linkmgr/hci_v2 has been moved up a directory.
  </defect>

  <defect number="138186" title="HCI Starvation time is left uncancelled" revision="207">
    Modified DeleteCommand to update the hci starvation timer whenever a command is removed from the command queue
  </defect>

  <defect number="DEF138146" title="Stack always sends LinkKeyRequestReplyNegative on PHY creation " revision="206">
    Added a check to ensure that a LinkKey has been requested before we allow the AuthenticationController to run
  </defect>

  <defect number="PDEF138345" title="Connection hangs if remote doesn't support extended features " revision="205">
    Connection completed using legacy pairing for the authentication, if extended features is not supported.
  </defect>
  
  <defect number="DEF137586" title="Speculative authentication can result in PIN Code request" revision="204">
    Modified DoPinRequestL to leave on speculative authentication.
  </defect>

  <defect number="PDEF134726" title="Debug mode allows authentication of link" revision="203">
    Allow SSP debug mode to be switched on with an existing link key in the registry. 
  </defect> 

  <defect number="PDEF134727" title="Debug mode uses general bonding io capabilities" revision="202">
     Advertise no bonding in IO_Capability_Request_Reply when debug mode is enabled.
  </defect>

  <defect number="DEF134040" title="[upf32] L2CAP accepts connections from same remote CID" revision="201">
    Change CL2CapLinkSignalHandler::HandleConnectionRequest() implementation so that it looks for existing channel
  </defect>

  <defect number="DEF137116" title="Set the same one as addressed play and browsed play, the TG EPOC crashed " revision="200">
     CAvctpTransport::GetChannelMtu updated to prevent crash
  </defect>

  <defect number="DEF137231" title="Panic on Reset complete event if initialisor plugin has async post reset command" revision="199">
     Fixed issue introduced by the fix for DEF133314, where the stack would panic when using an initialisor
	 that sends an asynchronous reset command.
  </defect>

  <defect number="DEF130747" title="[Coverity]-EVALUATION_ORDER,MISSING_BREAK,USE_AFTER_FREE -bluetooth/latest " revision="198">
     Fix Coverity issues.
  </defect>

  <defect number="PDEF136616" title="Extended features requested even if remote doesn't support them " revision="197">
    Updated CPhysicalLink for HCI V2 so that the extended features request is sent (if supported) once the supported features request has completed.
  </defect>

  <defect number="DEF136632" title="Removing HCI v1 from stack" revision="196">
    Removed HCI V1 from Bluetooth stack. 
  </defect> 

  <defect number="DEF134443" title="Sporadic failure on naviengine of AVRCP14 BV-0003" revision="195">
    Increased the Muxer Idle Timeout and toughen the Idle() method up
  </defect>

  <defect number="PDEF135115" title="HCI Server cannot be used without loading the BT Stack" revision="194">
    Create a new version of the HCI Server that is responsible for ensuring the BT Stack is not unloaded while it has active sessions.
  </defect>

  <defect number="DEF132882" title="[ONB Coverity]  NULL_RETURNS failure in RFComm" revision="193">
    Check for NULL value returned from CRfcommMuxer::FindSAP() and add the same check in logging method before derefernecing the pointer.
  </defect>

  <defect number="DEF133314" title="Not sure about EHCICtrlrInitNoOutstandingCmds panic in CommandCompleteEvent" revision="192">
    Change the condition in CHCIFacade::CommandCompleteEvent() from: if(iInitState != EInitialised) to: if(iInitState == EPostReset)
    since the code within is only intended to be run after the class has gone through the resetting sequence and the 
	EIdle/EPreReset/EResetting/EReset states. 	
  </defect>

  <defect number="DEF134040" title="[upf32] L2CAP accepts connections from same remote CID" revision="191">
    CID now checked against list of open connections.
  </defect>

  <defect number="DEF133566" title="Pairing Server sessions do not hold the Bluetooth stack open" revision="190">
    Add changes to secman, pairingserver and pairingsession to register sessions to hold stack open.
  </defect>

  <defect number="PDEF134136" title="[Lisbon] Previous PIN code length should not be enforced for new pairing" revision="189">
    Updated CBTPinRequester to handle passed in recommended PIN code length.
    Updated CPhysicalLink::DoPinRequestL() so that previous PIN code length is not set as required PIN code length for new pairing, but instead recommended PIN code length.
  </defect>

  <defect number="DEF133729" title="Headercheck failures in Bluetooth" revision="188">
    Updated 1 header file to #include e32base.h.
  </defect>

  <defect number="DEF133857" title="[ONB Coverity] UNINIT errors in L2Cap" revision="187">
    Initialised a previously uninitialised member field to zero in two methods in l2caplinksignalhandler.cpp.
  </defect>

  <defect number="DEF132013" title="Leavescan errors in avdtp" revision="186">
    Renamed RETURN_IF_BAD_SIGNAL macro to RETURN_IF_SIGNAL_BAD to avoid false positive Leavescan errors.
  </defect>

  <defect number="DEF133195" title="TPanTestGAVDP and gavdp_tester_emu.script have failures" revision="185">
	Corrections to deal with what is returned from CL2CAPConnectionSAP::GetData().
  </defect>

  <defect number="PDEF132897" title="[ONB Coverity] USE_AFTER_FREE error in secman" revision="184">
    Correct an object use after destruction in secman btaccessrequester.cpp.
  </defect> 

  <defect number="PDEF132899" title="[ONB Coverity] UNINIT error in secman " revision="183">
    Added coverity intentional comment to filter false positive from coverity.
  </defect> 
 
  <defect number="PDEF133090" title="Entire Vendor event sent to Vendor SAP for HCI v2 only" revision="182">
	Updated HCI v2 to behave like v1 when a Vendor specific event is received. The event data is now only sent to the Vendor SAP instead of the entire event.
  </defect>
 
  <defect number="DEF132000" title="Lint error in simplepairingresult.cpp" revision="181">
    Updated CBluetoothSecurityResultList::NewResult() to avoid redeclaration of the TBluetoothSecurityResult* entry pointer.
  </defect>

  <defect number="PDEF131616" title="Lisbon: CBTInquiryMgr::MhcqcCommandErrored needs implementation" revision="180">
    Added implementation for MhcqcCommandErrored.
  </defect> 

  <defect number="PDEF132429" title="Hciproxy unable to receive unexpected Vendor Specific Events" revision="179">
    1) Prevent vendor debug event panicking stack in debug mode (issue only in BT v2.1 stack).
    2) Prevent HCI level Ioctl with Ioctl 'name' KHCIWriteVendorSpecificFrameIoctl completing immediately (issue only in HCI_v1 stack). 
  </defect>

  <defect number="PDEF132432" title="No checking for valid vendor specific event in CommandCompleteEvent" revision="178">
    A check for NULL value is added before dereferencing the event pointer.
  </defect>

  <defect number="PDEF132431" title="Lisbon: Clear authenticaiton/pairing result lists when observer removed" revision="177">
     Updated CBluetoothSecurityResultList::ReleaseObserver() so that iResultList is cleared when the observer is removed.
   </defect>

  <defect number="DEF132012" title="Leavescan error in btprt" revision="176">
    Modified InstallBTProtocolFamily() to trap any leaves generated by CBTProtocolFamily::NewL() and return NULL in the event of a leave occuring.
  </defect>

  <defect number="PDEF130682" title="L2CAP - minor issues with handling oversized SDUs and GetData esock interface" revision="175">
    Return value of CL2CAPConnectionSAP::GetData changed to be 1 or a negative error value.
  </defect>

  <defect number="DEF132011" title="Leavescan error in hci_v2" revision="174">
    Trapped the leave and added an ASSERT_DEBUG to panic if there is an error.
  </defect>

  <defect number="DEF131799" title="A small ACL buffer will cause problem in non-basic mode" revision="173">
    HL2CapPDU::GetPDUOrFragmentSize ammended to allow for ACL buffer sizes lower than 183.
  </defect>

  <defect number="DEF130911 " title="[Future OS Product] Build warnings in bluetooth " revision="172">
    Corrected code to stop build warnings
  </defect>

  <defect number="PDEF131664" title="Missing hci complete events for bluetooth 2.1 features" revision="171">
    Added events for EncryptionKeyRefreshComplete and RemoteHostSupportedFeaturesNotification to supported events mask.
  </defect>

  <defect number="PDEF131617" title="Security result APIs can panic with E32USER-CBase 33" revision="170">
    Used CleanupClosePushL to push the CObject derived class onto the cleanupstack.
  </defect>

  <defect number="DEF131182" title="KERN-EXEC 3 in ESock_Bt handling connection complete event" revision="169">
    Do not assume the existance of a related command when the HCIFacade receives a Connection Complete Event.
  </defect>

  <defect number="PDEF131558" title="(urgent) BT host resolver returns no devices or completes early" revision="168">
    Updated all HCI implementations so that a call to CBTInquiryMgr::StartInquiry() when an identical inquiry is already running results in the host resolver being passed the results accumulated so far by the already running inquiry.
  </defect>

  <defect number="PDEF131210" title="[upf31] AVDTP rejects abort for unknown SEID, where it should be dropped" revision="167">
    CAvdtpInboundSignallingMessage::DoHandleAbortL modified handling of error response.
  </defect>

  <defect number="DEF130413" title="Unused code in ACL SAP should be removed" revision="166">
    Removed declarations from aclsap.h. Removed initialisation of iAvdtpSessions from aclsap.cpp.  
  </defect>

  <defect number="DEF130668" title="LISBON: Baseband Lisbon Tests have multiple failures" revision="165">
    Added the refresh encryption complete event to the hci event mask.
  </defect>

  <defect number="PDEF131211" title="LocallyInitiated is always set to EFalse for NumericComparision Notifiers" revision="164">
    Updated the access requester with other intermediate SSP states which can exists when authentication is pending.
  </defect>

  <defect number="DEF127178" title="LISBON: Incorrectly authenticated link connection attempted with iVoicePro." revision="163">
    Changed handling of EUnauthenticatedCombinationKey.
  </defect>

  <defect number="PDEF130953" title="No way to cancel initialisor callback" revision="162">
    Add new API to initialisation plugin to allow stack to abort initialisation.
  </defect>

  <defect number="PDEF130811" title="LC_Fute: Data transfer too slow" revision="161">
    Take Rfcomm max frame size into account when calculating optimal MTU value. Also improved basic mode optimisation.
  </defect>

  <defect number="DEF126562" title="SMP: Migrate avctp to Bluetooth logger" revision="160">
    Logging changed to use standard Bluetooth logger.
  </defect> 

  <defect number="DEF125659" title="SMP: Migrate stack to Bluetooth logger" revision="159">
    Replace non-standard bluetooth statck logging with more standard logger under control of commsdbg.ini
  </defect> 

  <defect number="DEF129716" title="SMP: bluetooth_stack doesn't compile for x86gcc platform" revision="158"> 
    Fixed non-ISO C++ compliant AVCTP code.
  </defect> 

  <defect number="DEF130010" title="Add logging-panic facility to btlogger" revision="157">
    Fix included undefining ASSERT; reworked code using ASSERT. 
  </defect> 

 <defect number="DEF124496" title="ACL link not idled if connection closed during authentication" revision="156">
    Updated the AuthenticationPending behaviour to use the AuthenticationComplete method ensuring an ACL Idle timer is started. 
  </defect> 

  <defect number="DEF124707" title="{Lisbon] Remaining PLM/EPR review comments" revision="155">
    Implemented the review comments.
  </defect>  

  <defect number="DEF129459" title="Failed pairing when remote device is quick at performing SSP" revision="154"> 
    Handled the case for quick remote device.
  </defect>  

  <defect number="PDEF129902" title="[upf31] When pairing with a display only device, we don't display a notifier" revision="153"> 
    Allow "Display Only" remote devices to be paired using "Man In The Middle". 
  </defect>  

  <defect number="PDEF129901" title="[upf31] Race condition on Connection Accept" revision="152"> 
    Gracefully handle the race condition in which a connection is accepted after it has timed out at the remote end.
  </defect>
 
  <defect number="PDEF129275" title="BT stack sends out of spec HCI disconnect commands when cancelling pairing" revision="151"> 
    Handle the case where a disconnect is requested on a link that is not yet fully established by disconnecting it as soon as it is established.
  </defect>   


  <defect number="PDEF129519" title="[UPF31] L2CAP: PDUs not delinked correctly from their parent SDU" revision="150">
    Delinked the PDU after it has been retrived from parent SDU. 
  </defect>    

  
  <defect number="PDEF129518" title="[upf31] Panic when connecting with denied in the security requirement" revision="149">
    Prevent a security ASSERT_DEBUG from firing when it should not
  </defect>

  <defect number="DEF125658" title="SMP: Migrate avdtp to Bluetooth logger" revision="148">
    Replace non-standard avdtp logging with more standard logger under control of commsdbg.ini
  </defect>

  <defect number="DEF127461" title="Optimal L2CAP MPS computation breaks FEC negotiation" revision="147">
    Fix Flow and Error control negotiation so local options don't overwrite all peer options
  </defect> 

  <defect number="DEF124706" title="Remaining EIR review comments and features" revision="146">
    CEirManager now will not be created unless EIR is supported by the hardware.
  </defect> 

  <defect number="DEF128204" title="errors in IM tagging in shortlink" revision="145">
    Correct the IM tagging.
  </defect>

  <defect number="DEF125179" title="[codenomicon] Remconserver Panics in a number of tests" revision="144">
    Fixed in avctp.
  </defect>

  <defect number="PDEF127745" title="Propagation of DEF114863: Errors in HCI_V2 code under 9.2 from PDEF112302" revision="143">
    Propagated the fixes from changelist #1120897 
  </defect>     

  <defect number="PDEF127573" title="hci command queue should be outside compliant portion for bt qualification" revision="142">
    Move HCI Command Queue to hci_v2 framework directory.
  </defect>

  <deliverystep number="1223" name="Bluetooth Core v2.1 Mandatory Features" osproject="Sphinx" revision="141">
    <preq number="1296" title="Bluetooth Core v2.1 Mandatory Features"/>
  </deliverystep>
  <milestone project="GT0368" number="3.8"/>

  <defect number="DEF127199" title="[Coverity]-SYMBIAN.CLEANUP_STACK-bluetooth/profiles" revision="140">
    Delete the local variable before it goes out of scope to avoid memory leak.
  </defect> 

  <defect number="DEF126067" title="Failures on BT21 TCK when run using M04623" revision="139">
    StrongPinRequired is initialized to default value EFalse.
  </defect> 

  <defect number="DEF126715" title="Warning experienced building for armv5 udeb" revision="138">
    Changed the code so it make more sense, thus the warning disappeared.
  </defect>

  <defect number="DEF118239" title="Changes necessary for EC120 submission" revision="137">
    Implemented changes needed for comms-infras EC120 submission. 
  </defect>

  <defect number="DEF125492" title="L2CAP attempts to disconnect PSM valued DCID during connection request" revision="136">
    Add the Enter method for TL2CAPSigStateWaitConnectRsp state to initialize the DCID.
  </defect>

  <defect number="DEF126773" title="Overly aggressive behaviour on unknown AVDTP capabilities" revision="135">
  	Remove unknown capabilities from a Get Capabilities response before validating the known capabilities.
  </defect>

  <defect number="DEF125492" title="Better modelling and handling of failed physical link disconnections" revision="134">
    Requeing idle timer when it fires and the link is idle, in case disconnect fails. Treating disconnect as having failed if Command Disallowed is returned
  </defect>

  <defect number="DEF126227" title="HCIv2 - Priority commands should not block other priority commands" revision="133">
    Add separate priority and workaround queues to the HCI command queue controller
  </defect>

  <defect number="DEF125689" title=" [coverity][lisbon] - USE_AFTER_FREE bluetooth/stack/secman/btaccessrequester.cpp" revision="132">
    Coverity failures prevented in btaccessrequester.
  </defect>

  <defect number="PDEF126217" title="MPhysicalLinksState virtual method are non-public." revision="131">
    Added the HCI Shared binary hcishared.dll to host three T-classes which need to be exported.
  </defect>

  <defect number="DEF125218" title="A succesful dedicated bond can return KErrAccessDenied" revision="130">
    Fixed the issue with link key race condition
  </defect>

  <defect number="DEF125857" title="[coverity] - EVALUATION_ORDER - bluetooth" revision="129">
    Evaulation order clarified in 2 files.
  </defect>

  <defect number="DEF125587" title="orphaned source file in stack\linkmgr\hci_v2" revision="128">
    Remove linkflowcontrol.cpp
  </defect>

  <defect number="DEF125359" title="Connect result is incorrect when connecting to NoIO device fails" revision="127">
    NoIO devices now handled in connections
  </defect>

  <defect number="PDEF125573" title="bluetooth viewsrv-11 with BH900" revision="126">
    Notify SCO object of error when a disconnect complete comes in, so the SCO object can be deleted
  </defect>

  <defect number="DEF124490" title="Many ReadClockOffset cmds sent and many BT Reg updates when connection closed" revision="125">
   Correctly managed a single outstanding ReadClock and BT reg update.
  </defect> 

  <defect number="DEF125265" title="Memory leaks in AVDTP" revision="124">
   Delete Asynchronous callback on the deletion of the Logical Channel Factory
   Delete the user plane transport session if the stream has gone away when the SAP is shutdown
  </defect>     

  <defect number="DEF124336" title="[Coverity]CLogicalChannelFactory::DoObtainChannelL checks dereferenced variable" revision="123">
   Verified that this behaviour is safe, expanded comments to clarify.
  </defect>     

  <defect number="DEF124735" title="KERN-EXEC3 in debug mode while logging trace in RegistryHelpers" revision="122">
   changed the debug to use CommsDB, also implemented james linkmgr fix.
  </defect>     

  <defect number="DEF124482" title="[UPF30] L2CAP MPS size used ignores the MPS provided from the peer device" revision="121">
   Take into account the MPS from the remote device when we calculate our optimal PDU size.
  </defect> 

  <defect number="PDEF124831" title="Phone crash and reset A2DP underflow situation" revision="120">
   Now Ioctl is correctly cleared avoiding to complete an Ioctl twice (that was the Panic Reason).
  </defect>

  <defect number="DEF124858" title="EIR Bluetooth name not updating when too long and no other data specified" revision="119">
   Max size of EIR data reduced to fit in DM5 packet.
  </defect>

  <defect number="DEF124809" title="Attempting a dedicated bond with a BT2.1 headset panics ESock_Bt" revision="118">
   Have secman check activity of access requesters after sending events.
  </defect>

  <defect number="DEF124269" title="Simultaneous General and Limited Inquiry panics stack" revision="117">
   Improve Inquiry manager handling of multiple Inquiries with different Inquiry Access Codes.
  </defect>

  <defect number="DEF124328" title="CAvctpPacketMgr::ConstructL has an unused variable" revision="116">
   Remove unused variable.
  </defect>

  <defect number="DEF124326" title="Check usage of DEBUG_PTR8" revision="115">
   Remove DEBUG_PTR8 as only used as a debugging aid.
  </defect>

  <defect number="DEF124327" title="[Coverity]CAvctpSapLinksMgr::ServiceProviderGoingDown could lock up in" revision="114">
   Include the iterator in the loop.
  </defect>   

  <deliverystep number="659" name="Bluetooth Core v2.1 Mandatory Features" osproject="Sphinx" revision="113">
    <preq number="1296" title="Bluetooth Core v2.1 Mandatory Features"/>
  </deliverystep>
  <deliverystep number="658" name="Bluetooth Core v2.1 Mandatory Features" osproject="Sphinx">
    <preq number="1296" title="Bluetooth Core v2.1 Mandatory Features"/>
  </deliverystep>
  <milestone project="GT0368" number="3.6"/>
 
  <defect number="INC122910" title="Symbian OS: HCIv2 intialisation fails when filtering out first message in the co" revision="112">
   Remove the first deletion which is not needed since command would be removed in CommandCompleteEvent.
  </defect>

  <defect number="PDEF123599" title="CBluetoothSocket using RFCOMM can panic the Bluetooth stack" revision="111">
   Guarding added to check that connection is complete/multiplexer is up before allowing some GetOpt's.
  </defect>

  <defect number="PDEF124159" title="Symbian stack crash in Plantronics HS P590" revision="110">
   Improved connection handling in CBTProxySAP
  </defect> 
  
  <defect number="DEF123598" title="remote device can cause l2cap to leak memory" revision="109">
   Introduced a function DeleteCommands(HL2CapCommand aCommandsToBeDeleted) to delete the iPendingCommands and iCommandsAwaitingResponse in the destructor of CL2CapLinkSignalHandler. 
  </defect> 

  <defect number="DEF123618" title="testexecute z:\testdata\scripts\pwrctrl.script test crashes" revision="108">
   Initializing iLastPowerState to EBTOn, since the stack is assumed to be power on status when HCIFacade starts up
  </defect> 

  <defect number="DEF123200" title="Filename case check fails" revision="107">
   change Capitaled Remotenamerequestcancelcommand.h in hcifacade_commands.cpp to remotenamerequestcancelcommand.h.
  </defect>

  <defect number="DEF123851" title="CPhysicalLink* FindPhysicalLink needs to define as const member function" revision="106">
   add const declaration for FindPhysicalLink(THCIConnHandle aConnH) and FindPhysicalLink()
  </defect> 

  <defect number="PDEF123000" title="DUT does not connect to BT stereo headset" revision="105">
   l2cap muxer no longer unsubscribes from physical link when l2cap layer is disconnected.
  </defect> 

  <defect number="PDEF123002" title="HL2CapPDU::GetPDUSize optimises on wastage not performance" revision="104">
    Now GETPDUSize optimises on performance.
  </defect>  

  <defect number="PDEF121952" title="Security risk! Encryption not enforced when requested" revision="103">
   Encryption now correctly managed and enforced when needed.
  </defect>

  <defect number="DEF122202" title="CHCIFacade::McioPreResetCommandComplete synchronously called with error." revision="102">
    Initialising iInquiryMgr before iHCIFacade->InitL gets called. Now it is able to handle a call with error.
  </defect> 

  <defect number="DEF121776" title="Stack doesn't re-open channels when power back on" revision="101">
    Add local variables to memorize free channels and power status.
  </defect> 

  <defect number="DEF121786" title="[miniupf3] AVDTP Panic when suspending at same time as being suspended." revision="100">
    Suspending while being in suspending state should not try to suspend.
  </defect>  

  <defect number="DEF121778" title="[miniupf3] Should cancel outstanding RNR before doing connection" revision="099">
    Cancel RNR sent to the controller when doing a connection.
  </defect>  

  <defect number="DEF121250" title="Make commsdbg logging in Bluetooth code work in UREL builds (i.e. on hardware)" revision="098">
    Fixed some #ifdefs for logging code to be compilable in UREL.
  </defect>

  <defect number="DEF121052" title="BT stack should handle unexpected retransmitted events on boot." revision="097">
    Stack now handles unexpected retransmitted events on boot.
  </defect>

  <defect number="PDEF122283" title="Bluetooth modem failure with KErrNotReady" revision="096">
    Ensure free credits are only sent to the remote once.
  </defect>

  <defect number="PDEF121320" title="A2DP (stereo) link can not be opened" revision="095">
    Free AVDTP logical channel IDs for errorred jobs
  </defect>

  <defect number="PDEF119945" title="Configuring L2CAP MTU for optimum performance" revision="094">
    MTU size requested by peer device can now be set.
  </defect>

  <defect number=" PDEF120492" title=" ALS PIOT [Nokia HS12W] No sound in Bluetooth-PHF after pressing Stop key an..." revision="093">
    CSignallingSession::SetOption() updated for ESendStartResponse and ESendSuspendResponse.
  </defect>

  <defect number="DEF119387" title="HCIv2 Controller init not performed if initially had an error" revision="092">
    Changed the iInitState to EIdle if the initialisor plugin has failed pre reset initialisation.
  </defect>

  <defect number="PDEF120228" title="SAP connection fail with NB" revision="091">
    HCI v1 notify the "issue command" completion immediately (like expected by the customer).
  </defect>

  <defect number="DEF117715" title="Tag scan failures in hci_v2" revision="090">
    Fix todos and doxygen tags in HCIv2.
  </defect>

  <defect number="DEF119028" title="No API to get inbound MTU for AVDTP media socket" revision="089">
   API added to get inbound MTU for AVDTP media socket
  </defect>

  <defect number="DEF117238" title="Correct LeaveScan error in physicallinks.cpp." revision="088">
    CPhysicalLink::LinkKeyRequest now traps a leaving function call.
  </defect> 

  <defect number="DEF118488" title="[upf29] MBuf 15 panic when L2CAP receives 0-length ACL data packet." revision="087">
    Placed a check on the length of PDU fragment before appending it to PDU chain.
  </defect> 

  <defect number="DEF118499" title=" [UPF29] Reassembly can fail if fragment is lost" revision="086">
    ACL fragment handling improved.
  </defect> 

  <defect number="PDEF118870" title="Klocwork issues, NULL pointer can be used in release build, bluetooth" revision="085">
    ClearSession method has been deleted because it is not used.
  </defect>

  <defect number="DEF117237" title="Correct LeaveScan error in avctp.cpp" revision="084">
    Call to CAvctpConnection::DataClientJoiningL in CAvctpProtocol::GetMuxerForIncoming wrapped with TRAP.
  </defect>

  <defect number="DEF112829" title="[upf28] AVDTP responds to General Reject with General Reject" revision="083">
    Drop incoming General Reject messages. NB: outstanding issue with SIG errata.
  </defect>

  <defect number="PDEF117129" title="Invalid CID used on L2CAP" revision="082">
    Updates to send correct CID on L2CAP.
  </defect>

  <defect number="DEF115695" title="Remove building of hci_v1 from >=v9.5..." revision="081">
    Bluetooth bld.inf files modified, and header files removed to exclude HCI v1 building from v9.5 onwards
  </defect>

  <defect number="DEF115091" title="Only one low-power mode command per connection_handle should be allowed in HCIv2" revision="080">
    Added a class used to post low power mode command to ensure that there is only one outstanding command per connection handle.
  </defect>

  <defect number="DEF116295" title="HCIFacade panics when faking a command status event" revision="079">
    Construct the TBuf8 object properly due to avoid panic.
  </defect>

  <defect number="DEF115807" title="Clarify component definitions and usage of avctp plugins" revision="078">
   bluetooth_providers.mrp has been removed.
  </defect>

  <defect number="DEF115198" title="Bluetooth stack panic while streaming audio to SEMC MBS-100 device" revision="077">
    EGavdpOpenInBadState GAVDP Usage error panic introduced.
  </defect>
  
  <defect number="DEF112517" title="Configuring L2CAP MTU for optimum performance" revision="076">
    Updates to allow negotiation of MTU size to improve performance.
  </defect>

  <defect number="DEF114380" title="EBTACLLogicalLinkBadDebind panic in ~CPhysicalLink" revision="075">
    Add more handling to prevent panicking of the stack when a Gavdp Connect is issued immediately after a Gavdp Cancel.
  </defect>

  <defect number="DEF112712" title="L2CAP Retransmission Disable bit not processed in recvd I-Frames" revision="074">
    Added code to manage the Retransmission Disable bit in CL2CapDataReTxController incoming IFrame handler.
  </defect>

  <defect number=" DEF114579" title="Changes needed in AVCTP to work with PREQ399" revision="073">
    AVCTP updated to work correctly with Converged Comms code changes.
  </defect>

  <defect number="DEF114172" title="Esockbt crashes in ASSERT_DEBUG for hci_v2" revision="072">
    Added error handling for ChangeConnectionPacketType command.
  </defect>

  <defect number="PDEF115231" title="Phone boot when connecting and disconnecting BT stereo HF from phone ui" revision="071">
    Add more handling to cancel outstanding AVDTP requests when a Gavdp Cancel is issued.
  </defect>

  <defect number="DEF112677" title="L2CAP can ignore negotiated packet size" revision="070">
    PDU size calculation now takes the Min the requested PDU size and the existing PDU size. 
  </defect>

  <defect number="PDEF114630" title="Vendor debug event handling on HCIv2 broken (chopped copy)" revision="069">
    Get return of vendorEvent.VendorDebugEvent() by ref instead of by value.
  </defect>

  <defect number="PDEF114880" title="No attempt to write the CoD info to the controller during BT on" revision="068">
    Adding ClearPendingLocalDeviceSettingsCoD() to clear persistent CoD value when bt is reset or powered off.
  </defect>
  
  <defect number="PDEF114277" title="LIBmm40820 APR: Esock_bt data abort in :~CHCICommandItem" revision="067">
    Corrections to fix build failures.
  </defect>
  
  <defect number="PDEF114277" title="LIBmm40820 APR: Esock_bt data abort in :~CHCICommandItem" revision="066">
    Added additional code to suggested areas to help identify any overflows.
  </defect>

  <defect number="DEF112713" title="[UPF28] Failure to retransmit when TxWin is full" revision="065">
    Additional function added: void CL2CapDataReTxController::PDUAvailable().
  </defect>

  <defect number="DEF111134" title="Devices are only added to the registry upon pairing" revision="064">
    Calls to StoreDeviceL added in linkmanager HCI v1 and 2.
  </defect>

  <defect number="PDEF113602" title="Phone boot when connecting and disconnecting BT stereo HF from phone ui" revision="063">
    Add handling to cancel outstanding AVDTP requests when a Gavdp Cancel is issued.
  </defect>

  <defect number="PDEF113340" title="Bluetooth stack doesn't fully handle errors (eg OOM) that occur in the registry" revision="062">
    Ensure that registry updates are correctly observed by an asynchronous thread.
  </defect>

  <defect number="DEF111138" title="Registry helpers had two error paths" revision="061">
    Errors TRAPD to have just one path.
  </defect>

  <defect number="DEF111368" title="Filename Policy non-conformance generates warnings in checksource build" revision="060">
    Files are changed in conformance to Filename policy
  </defect>

  <defect number="PDEF112316" title="Limited discoverable CoD bit not set" revision="059">
   CoD service bits need to reflect the correct status of the device
  </defect>

  <defect number="PDEF112573" title="Esock_BT crash when switching BT headset off during call" revision="058">
    Implement CBluetoothProtocolBase::Error() to stop base class panic.
  </defect>

  <defect number="PDEF111707" title="Erroneous behaviors when transfer sound to inactive Sink device" revision="057">
    Use the remote address asssociated with a signalling channel, instead of failing because there's no bearer up.
  </defect>

  <defect number="PDEF111536" title="Increased RFCOMM timer causes connection problem with several HF" revision="056">
    Changed RFCOMM mux idle timeout to be 5 seconds on disconnection.
  </defect>

  <defect number="DEF110228" title="Exported header (metadata.h) under /epoc32/include has a conflicting name" revision="055">
    Metadata header file include paths updated
  </defect>

  <defect number="PDEF110977" title="Bluetooth security notifier passes 532 bytes by value so possible stack overflow" revision="054">
    Changed to pass TBTNotifierUpdateParamsPckg by const ref.
  </defect>

  <defect number="PDEF110808" title="A (currently closed) remote DoS attack vector needs commenting" revision="053">
    This is a COMMENTS ONLY change.    
  </defect>

  <defect number="DEF110315" title="IMPORT_C/EXPORT_C issues" revision="052">
    Corrected declaration of two functions of CCapabi?ityParseVisitor (gavpinterface.h)
  </defect>

  <defect number="PDEF110224" title="NULL pointer dereference possible on AVDTP signalling session" revision="051">
    Ioctls, SetOpts and GetOpts were using descriptors passed to their methods, without checking the validity. 
  </defect>

  <defect number="DEF108386" title="[upf27]Outgoing AVDTP connections are not secure" revision="050">
    Authentication and Encryption now demanded for outgoing AVDTP connections
  </defect>

   <defect number="DEF097231" title="HCIv2 open issues" revision="049">
    Corrected problems with CmdQ event matching.  
  </defect>

  <defect number="DEF110440" title="Change Pan Profile code so it works with PREQ399" revision="048">
    submit the code changes developed for REQ7657
  </defect>

  <defect number="PDEF109248" title="PBAP connection problem with BH-902 and BH-903" revision="047">
    PBAP ?onnection problem with BH-902 and BH-903
  </defect>

  <defect number="PDEF108899" title="L2Cap transmit MTU not reported correctly after being specifically set" revision="046">
    The L2Cap interface constant KL2CAPGetOutboundMTU has been split into two: KL2CAPNegotiatedOutboundMTU and KL2CAPOutboundMTUForBestPerformance. The former if used with a GetOpt will return the outbound MTU actually negotiated with the remote, the latter is simply a more descriptive alias for KL2CAPGetOutboundMTU.
  </defect>

  <defect number="PDEF108465" title="BT SAP Pairing does not work" revision="045">
    BT SAP Pairing does not work
  </defect>

  <defect number="PDEF108271" title="BT headset connection dropping often" revision="044">
    Correct baseband model and its usage so that it should never overestimate bandwidth usage. Re-instate use of the baseband model upon request to bring up a SCO link.
  </defect>

  <defect number="DEF108087" title="[upf27] Short idle timer in RFCOMM" revision="043">
    Short idle timer in RFCOMM
  </defect>

  <defect number="DEF107332" title="HCI v2 Panic when hold mode disallowed" revision="042">
    Low power mode request failures will no longer cause HCIv2 to panic in debug mode.
  </defect>

  <defect number="PDEF107703" title="Wrong Rejection Error Message Whilst In Accept Paired Only Mode" revision="041">
    Wrong Rejection Error Message Whilst In Accept Paired Only Mode
  </defect>

  <defect number="PDEF107071" title="Panic in AVDTP after open command is rejected" revision="040">
    Panic in AVDTP after open command is rejected
  </defect>

  <defect number="DEF106246" title="HCIv2 makes assumption that client goes asynchronous on initialisation" revision="039">
    Avoid the asynchronous startup of the CmdQ
  </defect>

  <defect number="PDEF106810" title="Problems accepting eSCO connections" revision="038">
    Problems accepting eSCO connections
  </defect>

  <defect number="DEF103820" title="AVDTP abort dropped while handling fragmented packets." revision="037">
    AVDTP abort dropped while handling fragmented packets.
  </defect>

  <defect number="PDEF105924" title="BullsEye Coverage Compiler is failing coverage builds" revision="036">
    Message pragmas simplified to prevent build warnings
  </defect>

  <defect number="PDEF106045" title="Problems with IsLinkProbablyPossible()" revision="035">
    If 2 ACLs exist, and one of them already has a SCO link, the second SCO connection over the other ACL now succeeds.
  </defect>

  <defect number="DEF105758" title="Avctp event classes are not zero'd at construction" revision="034">
    Avctp event classes are not zero'd at construction
  </defect>

  <defect number="DEF104811" title="HCIv2 can panic when disconnecting parked (LMP) BT socket." revision="033">
    The original (HCI_Exit_Park_State) fix has been re-worked to provide a more "protocol agreeable" solution.
  </defect>

  <defect number="PDEF104493" title="BT pairing cancellation is not working after passcode entered" revision="032">
    Alter the Bluetooth stack so that an"Unpair" called on the registry whilst the as?ociated Bluetooth physical link is active will no longer be ignored.
  </defect>

  <defect number="PDEF105718" title="BT: remote SCO link state change does not cause audio to re-route. P3" revision="031">
    Remote SCO link state change should now cause audio to re-route.
  </defect>

  <defect number="PDEF105137" title="L2CAP retransmission mode lockup / L2CAP 42 panic in UDEB" revision="030">
    The L2Cap layer now no longer stalls when operating in retransmission mode concurrently with a name inquiry.
  </defect>

  <defect number="PDEF105139" title="Phone hangs when starting sync with pc suite during data transferring connection" revision="029">
    In RFComm blocked SAPs are now added to the beginning of the blocked SAP queue as opposed to the end.
  </defect>

  <defect number="PDEF102785" title="BT device name not changed after reboot" revision="028">
    HCI v1/HCI v2: Intr?ducing TBTTrackedLocalDevice class, so updates to BT registry are not done all settings in one shot, but only update settings which have been changed.
  </defect>

  <defect number="DEF104882" title="Kern Exec 3 in CBTHostResolver::GetIAC() (causes Java BT TCKs to fail)" revision="027">
    CBTHostResolver::GetIAC() now checks iNameRecord for NULL, before dereferencing.
  </defect>

  <defect number="DEF103460" title="RFCOMM doesn't idle a passive mux channel that gets no mux" revision="026">
    Passive L2CAP connections that expect an RFCOMM will timeout (10s) if the SABM is not received.
  </defect>

  <defect number="DEF099005" title="HCIv2: Command Queue makes a bad assumption about 0 credit commands" revision="025">
    HCIv2: Command Queue makes a bad assumption about 0 credit commands
  </defect>

  <defect number="DEF104461" title="Forward Propagation of INC103148 A32 codenomicon A2DP test failure" revision="024">
    Forward Propagation of INC103148 A32 codenomicon A2DP test failure
  </defect>

  <defect number="PDEF102805" title="Bluetooth Stack try to write 11 time CoD" revision="023">
    Modified linkmgr to inhibit unnecessary CoD writes.
  </defect>

  <defect number="PDEF103389" title="Sometimes Bt link drop when Bt stereo connection established from HF" revision="022">
    GAVDP now rejects a Start attempt when in Starting mode
  </defect>

  <defect number="PDEF103671" title="DEF98980 requires adaptation changes in CHI which aren't obvious" revision="021">
    Replaced magic numbers by appropriate constants
  </defect>

  <defect number="DEF103096" title="Missing propagation to HCIv2 platform, very high interoperability problem" revision="020">
    Missing propagation to HCIv2 platform, very high interoperability (Incomming pairing, disconnection before sending link key reply (Inactive) )
  </defect>

  <defect number="PDEF096969" title="P&amp;S race condition in bt stack now has impact on security" revision="019">
    To cover the effects of a race condition, the Bluetooth stack now checks the registry's remote table for ALL registry initiated P&amp;S notifications.
  </defect>

  <defect number="DEF101319" title="Filename case check failures in source build and test" revision="018">
    Corrected filenames to enable building of Symbian OS in Linux
  </defect>

  <defect number="DEF102249" title="upf26: Media Transport Capability not included in AVDTP Set Configure" revision="017">
    Media transport capability not included in avdtp set configure (after rejected configure)
  </defect>

  <defect number="PDEF104208" title="UPF26: Inquiry started automatically when bonding" revision="016">
    Fixing a problem where if an Inquiry was cancelled, then an independent Remote Name Request was started, another inquiry could be started
  </defect>

  <defect number="PDEF104145" title="PDEF068170 not yet propagated to hci_v2" revision="015">
    Bringing HCIv1 and HCIv2 link managers into line, by removing some funcionality to change link keys, which had previously been removed from HCIv1
  </defect>

  <defect number="PDEF103389" title="Sometimes Bt link d?op when Bt stereo connection established from HF" revision="014">
    GAVDP now rejects a Start attempt when in Starting mode
  </defect>

  <defect number="PDEF103671" title="DEF98980 requires adaptation changes in CHI which aren't obvious" revision="013">
    Replaced magic numbers by appropriate constants
  </defect>

  <defect number="DEF103096" title="Missing propagation to HCIv2 platform, very high interoperability problem" revision="012">
    Missing propagation to HCIv2 platform, very high interoperability (Incomming pairing, disconnection before sending link key reply (Inactive) )
  </defect>

  <defect number="PDEF096969" title="P&amp;S race condition in bt stack now has impact on security" revision="011">
    To cover the effects of a race condition, the Bluetooth stack now checks the registry's remote table for ALL registry initiated P&amp;S notifications.
  </defect>

  <defect number="DEF102822" title="Remove authserver component from 9.3 build" revision="010">
    If L2Cap receives a disconnection request, whilst being configured, the SAP signalling queues are now flushed before sending a disconnection response.
  </defect>

  <defect number="PDEF102205" title="Can?t pair with other phones via BT after pairing failed at the first time." revision="009">
    Tidied up some calls to leaving functions inside non leaving ones in the security manager by adding in calls to TRAP macros. Tweaked the deletion procedure of the security notifier update active object.
  </defect>

  <defect number="PDEF101752" title="Interop failure with the IHF 1000 carkit (used as Volvo carkit)" revision="008">
    Slightly slow down L2Cap configuration in order to accommodate the IHF1000 car-kit (old version).
  </defect>

  <defect number="DEF099550" title="Restructuring phy linkmgr for pairingscache approach" revision="007">
    Restructured phy linkmgr for the pairingscache approach.
  </defect>

  <defect number="PDEF101795" title="Stereo audio is missing with A2DP-device" revision="006">
    Failed configuration could have led to incorrect sep in use claim.
  </defect>

  <defect number="PDEF099922" title="HCI: RemoteNameReqCompleteEvent supplies spurious characters on end of device na" revision="005">
    Remote name recipt event handling improved to store the remote name in a descriptor of the relevant size rather than always using one of the maximum possible name length.
  </defect>

  <defect number="PDEF100444" title="SCO Connections fail between 2 eSCO enabled controllers" revision="004">
    Fix to bluetooth stack for a problem when trying to set up a SCO connection between two EDR enabled controllers
  </defect>

  <defect number="PDEF099901" title="AFH channel assesment mode cannot be switched on dynamically" revision="003">
    Allow AFH Channel Assessment to be switched off (and back on again).
  </defect>

  <defect number="PDEF100259" title="File sending from 3.1 to 3.0 fails" revision="002">
    Check only the link mode when trying to detect if the channel is basic mode in one direction and FEC in the other. All the other parameters will have been sorted out in the channel nogotiation before we get to the open state.
  </defect>

  <defect number="PDEF100260" title="L2CAP sends retransmission packets after configured as basic mode" revision="001">
    Change the L2Cap configuration API so that it does not disrupt the L2cap configuration algorithm.
  </defect>
</relnotes>
